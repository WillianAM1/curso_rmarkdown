--- 
title: "Introdução ao R Markdown"
author: "Eduardo José de Campos Lemos Júnior, Samuel Vianna Quintanilha"
date: "`r Sys.Date()`"
output: pdf_document
description: Curso de R Markdown...
documentclass: book
link-citations: yes
site: bookdown::bookdown_site
biblio-style: apalike
github-repo: estatsej/curso_rmarkdown
---

<!--chapter:end:00-index.Rmd-->

# Introdução {#intro}
Neste curso, iremos aprender a utilizar o R Markdown para gerar documentos.

## O que é 
Markdown é uma linguagem de marcação usada para formatar de maneira simples os textos redigidos e converte-los em HTML. John Gruber e Aaron Swartz, os criadores desse sistema, utilizaram marcadores como: `#, \* ,! , [] e ()`. Assim é possível inserir em nossos textos: títulos, listas, formatação de fonte, imagens e tabelas.
R Markdown é um documento criado no R Studio (Ou em outras IDEs) que possibilita empregar os recursos da linguagem markdown citados acima em conjunto com a linguagem R, permitindo a melhor organização de análises, relatórios e códigos em um só documento.


## Possíveis tipos de Outputs
O R Markdown apresenta várias possibilidades de outputs (renderizar) nos formatos de documentos, apresentações, entre outros, sendo que em cada formato há várias opções de customização. Vejamos abaixo os principais: 

Documentos:

- html_document – documento no formato HTML;
- pdf_document – documento no formato PDF (via o modelo LaTeX);
- word_document – documento no formato do editor de texto Microsoft Word (docx);
- odt_documento – documento no formato dos editores de texto Libre Office e OpenDocument;
- rtf_documento – documento no formato Rich Text Format (rtf).

Apresentações (slides):

- ioslides_presentation – apresentação no formato HTML com ioslides;
- beamer_presentation – apresentação no formato PDF com LaTeX Beamer;
- powerpoint_presentation – apresentação no formato power point.

Outros:

- flexdashboard::flex_dashboard – apresentação interativa com dashboards;
- htm_vignette – R package vignette no format HTML
- github_document – document no format GitHub

Você pode escolher o output desejado quando for criar um documento conforme a figura 1.  Para fazer deve-se clicar em `file > new file > R Markdown`. Abrirá uma aba e nela há quatro formas de output previamente estabelecidas, a saber: Document (HTML, PDF e Word), Presentation (HTML (ioslides), HTML (slidy), PDF (Beamer) e PowerPoint), Shiny (Shiny Document e Shy Presentation) e From Template (GitHub document e Package Vignette).  Escolha uma e clique em OK. 
Além disso, você também pode alterar o formato utilizando a função abaixo, sendo que render refere-se ao local que está salvo seu documento e output_format ao tipo de documento desejado, conforme os exemplos apontados no início. 

```{r, eval = FALSE}
render("teste.Rmd", output_format = "pdf_document")
```

O mesmo pode ser feito para outros formatos. 
Abaixo está presente uma lista com todos os formatos suportados por padrão com o pacote `rmarkdown`.

`r knitr::combine_words(grep('^[^_]+_(document|presentation)$', ls(asNamespace('rmarkdown')), value = TRUE), sep = '\n', and = '', before = '- \x60', after = '\x60')`

## Criando o primeiro documento
Para gerar um arquivo em R Markdown é necessário abrir o programa R Studio, e instalar o pacote rmarkdown :
<!--![](img/ins.png)-->
```{r, eval = FALSE}
install.packages("rmarkdown")
```

Após a instalação do pacote no R Studio, siga os seguintes passos:
![](img/new.png)

Em seguida, escolha o tipo de arquivo desejado:
![](img/file.png)

Obs: Para gerar documentos em PDF, é necessário ter instalado em seu computador o programa [Latex](#download-rmd-e-latex)

Seguindo os passos acima, você terá criado o seu primeiro documento em R Markdown.

Vale ressaltar que é possível utilizar o R Markdown sem que tenha instalado o R Studio, porém, é necessário ter instalado o programa [Pandoc](https://pandoc.org)

## Download MiKTeX
Para exportar um arquivo PDF utilizando o R Markdown é necessário um motor LaTex pois é ele que irá converter o arquivo .tex em PDF.
Então é necessário que tenha instalado em seu computador o programa MiKTeX,. Para fazer o download é só acessar o link: https://miktex.org/download.

### Windows
Selecione a aba Windows e clique no botão de download:
![](img/download_windowns_MiKTex.jpg)

### Linux
Selecione a aba Linux em seguida a aba de sua distribuição Linux para receber as instruções de instalação:
![](img/download_linux_MiKTex.jpg)

### MacOS
Selecione a aba macOS e clique no botão de download:
![](img/download_macOS_MiKTex.jpg)

<!--chapter:end:01-introducao.Rmd-->

---
output:
  word_document: default
  html_document: default
  pdf_document: default
---
# Sintaxe

## Prêambulo

No início de um documento R Markdown, é utilizada a linguagem [yaml](https://pt.wikipedia.org/wiki/YAML) para definir as configurações do seu arquivo.
As configurações disponiveis no preâmbulo do seu documento R Markdown são variadas, podendo inclusive ter diferentes opções para diferentes tipos de arquivos.
Uma das configurações mais importantes para se definir no seu preambulo é o [tipo de documento](#possíveis-tipos-de-outputs) a ser gerado.

### Definindo tipo de output

A opçao de [tipo de documento](#possíveis-tipos-de-outputs) é definida da seguinte forma:

```
---
output: pdf_document
---
```

No código acima, `output` foi definido como `pdf_document()`. Output é o formato final do seu documento, e `pdf_document()` é, dentro do pacote `rmarkdown`, o formato pdf. Para gerar arquivos de formatos diferentes, é necessário somente que seja modificado a opção de `output` no preâmbulo.
Note que a opção definida no preâmbulo foi escrita entre duas linhas tracejadas, não é possível definir suas configurações fora dessas linhas tracejadas, da mesma forma, não é possível escrever partes do seu documento ou rodar códigos de `R` dentro das linhas.
Por padrão no `yaml` utilizado no preâmbulo de R Markdown, a opção a ser definida é escrita sem espaços, seguida de dois pontos, espaço e então a definição da opção.
Existem opções dentro de outras opções, como por exemplo `pdf_document()`, podemos definir configurações se o documento terá ou não sumário, quantos níveis de [cabeçalho](#cabeçalhos) serão utilizados no sumário, etc.

```
---
output: pdf_document:
  toc: true
  toc_depth: 3
  latex_engine: xelatex
---
```

No exemplo acima, definimos `toc` (table of contents) como `true`, o que vai fazer com que seja gerado um sumário no documento final, perceba que em `yaml` o valor lógico de verdadeiro é escrito com todas as letras minúsculas. Definindo `toc_depth` como `3`, quando o sumário for gerado, até três níveis de [cabeçalho](#cabeçalhos) apareceram no sumário.

### Informações Gerais

Além do tipo de documento, e das opções de cada tipo de documento, podemos definir algumas opções gerais, como autor, título do documento, e data.

```
---
author: "Fulano"
output: pdf_document:
  toc: true
  toc_depth: 3
  latex_engine: xelatex
---
```

Seguindo com o preâmbulo já feito anteriormente, foi adicionada a opção `author`, que irá definir o autor do seu documento. Por padrão, o autor irá aparecer na página inicial de diversos [tipos de documento](#possíveis-tipos-de-outputs).

```
---
date: 1 de janeiro de 1970
output: pdf_document:
  toc: true
  toc_depth: 3
  latex_engine: xelatex
author: Fulano
---
```

Utilizando a opção `date` podemos definir uma data para o documento, semelhante ao autor, a data aparece por padrão no início dos documentos.
Perceba que no exemplo acima, o nome do autor e a data foram escritas sem aspas, mas irão funcionar da mesma forma, perceba também que a opção do autor foi trocada de ordem, as opções do preâmbulo não necessitam de uma ordem específica, mas as opções de dentro de outras opções devem sempre estar abaixo da opção mae (sei la como chamar isso) e com uma identação a mais.

```
---
author: Fulano
date: 1 de janeiro de 1970
title: Título
output: pdf_document:
  toc: true
  toc_depth: 3
  latex_engine: xelatex
---
```

Por fim foi definida também a opção `title` que irá definir o título do documento final. Para maior customização do seu documento pelo preâmbulo veja o [capítulo 4](#depois-crio).

### Sumario

## Textos


### Títulos

```
# Título Nível 1

## Título Nível 2

### Título Nível 3

#### Título Nível 4

##### Título Nível 5

###### Título Nível 6
```


### Formatação de textos (negrito, itálico, sobrescrito, tachado e código)

```
*Negrito* _Negrito_
```

**Negrito** __Negrito__

```
**Italico** __italico__
```

*Italico* _Italico_

```
texto^sobrescrito^
```

texto^sobrescrito^

```
~~~tachado~~

````
~~~tachado~~

### Links

Para um link devemos utilizar a seguinte sintaxe:
```
[nome do link](url do link)
[Curso de RMarkdown](https://estatsej.github.io/curso_rmarkdown)
```
Existem também outras variações para que utlizemos os links em nosso material.

__1 - Nome do link seja ele próprio__:

https://estatsej.github.io/curso_rmarkdown

__2- Link contendo um título, que aparece ao deixar o cursor do mouse em cima do link:__

```
[Curso de RMakrdown](https://estatsej.github.io/curso_rmarkdown "Aqui está o nosso curso de RMarkdown")
```
Podemos observar:
[Curso de RMakrdown](https://estatsej.github.io/curso_rmarkdown "Aqui está o nosso curso de RMarkdown")


### Listas

__Lista Ordenada__

```
1. Primeiro item
2. Segundo item
3. Terceiro item
```

__Lista Não-Ordenada__
```
- Primeiro item
- Segundo item
- Terceiro item
```

__Lista com Sublista__
```
1. Item
    - Um sub-item
    - Outro sub-item
```

## Inserindo Imagens

Antes de inserir a imagem escolhida podemos definir a configuração global para todas as imagens, lembrando que a configuração feita diretamente na imagem vai sobrepor a configuração global.

````markdown
`r ''````{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = FALSE,
               out.width = "10%", 
               fig.align = "center")
```
````

Se um gráfico ou imagem não for gerado a partir de um código feito por R, você poderá incluí-lo de duas maneiras:

- Usando a sintaxe Markdown ```![texto](pasta/para/image)```. Nesse caso, você pode definir o tamanho da imagem usando os atributos ```width``` ou ```height```, por exemplo:

```
![Logo da Estats](http://tny.im/lTZ){width=50%}
```

- Usando a função ```knitr::include_graphics(```) em qualquer parte do código. Você pode usar opções de configuração de tamanho como ```out.width``` ou ```out.height``` para esse exemplo:

````markdown
`r ''````{r, echo=FALSE, out.width="50%", fig.cap="Logo da Estats"}
knitr::include_graphics("http://tny.im/lTZ")
```
````
Se você souber que deseja gerar a imagem apenas para um formato de saída específico, poderá usar uma unidade específica. Por exemplo, você pode usar ```out.width="300px"``` se o formato de saída for HTML, mas no nosso exemplo o formato que usamos ```out.width="50%"``` é válido para qualquer saída.

E podemos aliar as imagens utilizando ```fig.align```. Por exemplo, você pode centralizar imagens ```fig.align="center"``` ou alinhar à direita as imagens ```fig.align="right'"```. Está opção funciona para saída HTML e LaTeX, mas pode não funcionar para outros formatos de saída (como o Word).

No código a seguir é utilizado quando o seu projeto tem múltiplas saídas (PDF,HTML,...) e ocorra problema na inclusão das imagens, então a sugestão para o melhor caminho foi fazer a validação para obter a saída utilizada, sabendo disso podemos fazer configuração e inserindo imagens especifica para cada saída.

````markdown
`r ''````{r, fig.cap="Logo da Estats"}
if (knitr::is_html_output()) {
    knitr::include_graphics("http://tny.im/lTZ")
} else {
    knitr::include_graphics("http://tny.im/lTZ")
}
```
````
```{r, fig.cap="Logo da Estats", fig.align = "center"}
if (knitr::is_html_output()) {
    knitr::include_graphics("http://tny.im/lTZ")
} else {
    knitr::include_graphics("http://tny.im/lTZ")
}
```

Os dois exemplos abaixo são casos de curiosidades:

- Nesse caso podemos utilizar vetor para colocar várias imagem juntas.

````markdown
`r ''````{r image}
include_graphics(c("img1.jpeg", "img2.jpeg"))
```
````

- E nesse último caso podemos fazer repetição de uma imagem várias vezes.

````markdown
`r ''````{r}
knitr::include_graphics(rep("http://tny.im/lTZ", 3))
```
````

```{r}
knitr::include_graphics(rep("http://tny.im/lTZ", 3))
```

## Exemplos

[Exemplo Sumário e Cabeçalhos](exemplos/102-sumario_e_cabecalho.html)

[Exemplo formatação de textos](exemplos/103-formatacao_de_texto.html)

<!--chapter:end:02-sintaxe.Rmd-->

# Executando Código

## Introdução

````
`r ''````{r}

```
````


## Flags

There are a large number of chunk options\index{chunk options} in **knitr** documented at https://yihui.name/knitr/options. We list a subset of them below:

- `eval`: Whether to evaluate a code chunk.

- `echo`: Whether to echo the source code in the output document (someone may not prefer reading your smart source code but only results).

- `results`: When set to `'hide'`, text output will be hidden; when set to `'asis'`, text output is written "as-is", e.g., you can write out raw Markdown text from R code (like `cat('**Markdown** is cool.\n')`). By default, text output will be wrapped in verbatim elements (typically plain code blocks).

- `collapse`: Whether to merge text output and source code into a single code block in the output. This is mostly cosmetic: `collapse = TRUE` makes the output more compact, since the R source code and its text output are displayed in a single output block. The default `collapse = FALSE` means R expressions and their text output are separated into different blocks.

- `warning`, `message`, and `error`: Whether to show warnings, messages, and errors in the output document. Note that if you set `error = FALSE`, `rmarkdown::render()` will halt on error in a code chunk, and the error will be displayed in the R console. Similarly, when `warning = FALSE` or `message = FALSE`, these messages will be shown in the R console.

- `include`: Whether to include anything from a code chunk in the output document. When `include = FALSE`, this whole code chunk is excluded in the output, but note that it will still be evaluated if `eval = TRUE`. When you are trying to set `echo = FALSE`, `results = 'hide'`, `warning = FALSE`, and `message = FALSE`, chances are you simply mean a single option `include = FALSE` instead of suppressing different types of text output individually.

- `cache`: Whether to enable caching. If caching is enabled, the same code chunk will not be evaluated the next time the document is compiled (if the code chunk was not modified), which can save you time. However, I want to honestly remind you of the two hard problems in computer science (via Phil Karlton): naming things, and cache invalidation. Caching can be handy but also tricky sometimes.

- `fig.width` and `fig.height`: The (graphical device) size of R plots in inches. R plots in code chunks are first recorded via a graphical device in **knitr**, and then written out to files. You can also specify the two options together in a single chunk option `fig.dim`, e.g., `fig.dim = c(6, 4)` means `fig.width = 6` and `fig.height = 4`.

- `out.width` and `out.height`: The output size of R plots in the output document. These options may scale images. You can use percentages, e.g., `out.width = '80%'` means 80% of the page width.

- `fig.align`: The alignment of plots. It can be `'left'`, `'center'`, or `'right'`.

- `dev`: The graphical device to record R plots. Typically it is `'pdf'` for LaTeX output, and `'png'` for HTML output, but you can certainly use other devices, such as `'svg'` or `'jpeg'`.

- `fig.cap`: The figure caption.

- `child`: You can include a child document in the main document. This option takes a path to an external file.

## Linguagens suportadas

```{r}
names(knitr::knit_engines$get())
```


<!-- citacoes **bookdown** [@R-bookdown] -->
<!-- Só pra ficar claro se alguem ler essa parte aqui, esse negócio esquisito é um comentário -->

## Exemplo
Para que o código seja executado no meio de um texto, é necessário usar o caractere `` ` ``, antes e depois do código descrito. Exemplo:

```{r, eval = FALSE, echo = TRUE}
Este texto gera: `r format(Sys.Date(), "%d/%m/%Y")`.
```

Este texto gera: `r format(Sys.Date(), "%d/%m/%Y")`.

***

O código também pode ser executado dentro de blocos. Blocos de código são inseridos da seguinte forma:
````markdown
`r ''````{r}
format(Sys.Date(), "%d/%m/%Y")
```
````

O que gera o seguinte output ao ser compilado seu arquivo R Markdown:

```{r}
format(Sys.Date(), "%d/%m/%Y")
```

***

Algumas das opções básicas de blocos de código [já mencionadas](#flags):
````markdown
`r ''````{r, echo = FALSE}
2 + 2
```
````

```{r, echo = FALSE}
2 + 2
```

````markdown
`r ''````{r, eval = FALSE}
2 + 2
```
````

```{r, eval = FALSE}
2 + 2
```

***

Exemplo de utilização de blocos de código para inserir imagens como descrito no [capítulo 2](#inserindo-imagens)

````markdown
`r ''````{r}
knitr::include_graphics("http://tny.im/lTZ")
```
````

```{r}
knitr::include_graphics("http://tny.im/lTZ")
```

***

Inserindo tabelas dentro de blocos de código:
````markdown
`r ''````{r}
knitr::kable(cars[1:5,], caption = "Carros")
```
````

```{r}
knitr::kable(cars[1:5,], caption = "Carros")
```

***

Exemplo utilizando outra [linguagem suportada](#linguagens-suportadas), neste caso python:
````markdown
`r ''````{python}
print(5 ** 3)
```
````

```{python}
print(5 ** 3)
```

***

Exemplos mais detalhados de R e de outras linguagens suportadas estão disponíveis neste [link](exemplos/104-intro_blocos_de_codigo.html).

<!--chapter:end:03-executando_codigo.Rmd-->

# Customização

## Opções avançadas no preâmbulo

## Tipos de documentos

### Apresentação de slides

### Documentos

### HTML

#### Opções de preâmbulo:

- highlight
- toc
- dev
- extra_dependencies
- toc_depth
- df_print
- css
- toc_float
- code_folding
- includes
- number_sections
- code_download
- keep_md
- section_divs
- self_contained
- lib_dir
- fig_width
- theme
- md_extensions=
- fig_height
- highlight
- pandoc_args
- fig_retina
- mathjax
- fig_caption
- template     

#### Opções de customização

tabsection

##### Exemplo com tabset {.tabset}

##### Aba 1

Conteúdo da aba 1

##### Aba 2

Conteúdo da aba 2

## Pacotes úteis

<!--chapter:end:04-customizacao.Rmd-->

# Referência

`r htmltools::includeHTML("../docs/exemplos/105-referencia.html")`

<!--chapter:end:05-referencia.Rmd-->

